document.domain="qq.com";var v20140624,upLoadImgError;
function toggleFullScreen(){var a=top.document;a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement?a.exitFullscreen?a.exitFullscreen():a.msExitFullscreen?a.msExitFullscreen():a.mozCancelFullScreen?a.mozCancelFullScreen():a.webkitExitFullscreen&&a.webkitExitFullscreen():a.documentElement.requestFullscreen?a.documentElement.requestFullscreen():a.documentElement.msRequestFullscreen?a.documentElement.msRequestFullscreen():a.documentElement.mozRequestFullScreen?
a.documentElement.mozRequestFullScreen():a.documentElement.webkitRequestFullscreen&&a.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}
(function(a,h,k){function r(a){return a}function g(a){return decodeURIComponent(a.replace(m," "))}var m=/\+/g,b=a.cookie=function(c,e,f){if(e!==k){f=a.extend({},b.defaults,f);null===e&&(f.expires=-1);if("number"===typeof f.expires){var d=f.expires,p=f.expires=new Date;p.setDate(p.getDate()+d)}e=b.json?JSON.stringify(e):String(e);return h.cookie=[encodeURIComponent(c),"=",b.raw?e:encodeURIComponent(e),f.expires?"; expires="+f.expires.toUTCString():"",f.path?"; path="+f.path:"",f.domain?"; domain="+
f.domain:"",f.secure?"; secure":""].join("")}e=b.raw?r:g;f=h.cookie.split("; ");for(d=0;p=f[d]&&f[d].split("=");d++)if(e(p.shift())===c)return c=e(p.join("=")),b.json?JSON.parse(c):c;return null};b.defaults={domain:"qq.com",path:"/",expires:7};a.removeCookie=function(b,e){return null!==a.cookie(b)?(a.cookie(b,null,e),!0):!1}})(jQuery,document);
(function(a,h,k,r){var g,m,b="onfocusin"in h&&"hasFocus"in h?"focusin focusout":"focus blur",c=["","moz","ms","o","webkit"],e=k.support,f=k.event;for(;(m=g=c.pop())!=r;)if(m=(g?g+"H":"h")+"idden",e.pageVisibility="boolean"==typeof h[m]){b=g+"visibilitychange";break}k(/blur$/.test(b)?a:h).bind(b,function(a){var b=a.type;a=a.originalEvent;var c=a.toElement;(!/^focus./.test(b)||c==r&&a.fromElement==r&&a.relatedTarget==r)&&f.trigger((m&&h[m]||/^(?:blur|focusout)$/.test(b)?"hide":"show")+".visibility")})})(this,
document,jQuery);"undefined"!=typeof $&&$.noConflict&&"object"!=typeof jQuery&&$.noConflict();var coralComment={};
jQuery(document).ready(function(){(function(a){var h=a(document);a(parent.document);a(window);var k=a("body"),r=null,g=g||parent.cmt_id,m="",m="www"==top.location.host.split(".")[0]?top.location.host.split(".")[1]:top.location.host.split(".")[0];coralComment={options:{$content:a("#content"),$loginTrigger:a("#onekey"),$logoutTrigger:a("#loginOut"),$popReply:a("#public_reply"),$topReply:a("#top_reply"),$top_textarea:a("#top_textarea"),$allComments:a("#allComments"),$showNum:a("#showNum"),$commentTotleNum:a("#commentTotleNum"),
$loadMore:a("#loadMore"),fetchUrl:"http://coral.qq.com/",wfetchUrl:"http://w.coral.qq.com/",pfetchUrl:"http://coral.qq.com/",topCallback:"parent.topCallback",popCallback:"parent.popCallback",reportCallback:"parent.reportCallback",deleteCallback:"parent.deleteCallback",$allComments:a("#tab1_allComments"),$myComments:a("#tab2_myComments"),$myTips:a("#tab3_tips"),$myCons:a("#tab4_mycon"),$loginFlag:a("#loginFlag"),$loginBtn:a("#top_post_btn"),$iframeHeight:"0",$replylistId:"",$myCowComment:a("#myCowComment"),
$myAllComment:a("#myAllComment"),$tabFlag:!0,$realtimeComments:0,$insertFlag:"comment",$nowDate:new Date,$urlapi:{userId:0,first:"",last:"",msgid:"",pageflag:0},$urlapi_mycomment:{userId:0,first:"",last:"",msgid:"",pageflag:0},loginuin:0,pubSucEvent:"commentpubsuccess",topContentTips:"",homePageSize:10,centerPageSize:10,loadPageSize:20,newsNum:0,hotNums:10,columSource:1,columsubSource:0,columCode:1,columApi:1,columLink:1,columHot:1,commentNumbers:"",popupInfo:"popClick",popupLink:"np-postlink",reportBtn:1,
centerFlag:0,changeFlag:0,reportId:"",hotPageSize:10,order:"",upId:"",siteName:"",lastId:"",huiyuan:0,film:0,client:0,dataImgObj:"[]",cmt_array:"",cmt_class:"",cmt_content:""},_create:function(){this.init();this.changeTab();this.bindSubmitEvent();this.bindReportEvent();this.bindDeleteEvent();this.bindFooterEvent(this.options.$content);this.bindOtherEvents();this.loadCommentNum();this.hotList();this.makeCommentList();this.tabsComment();this.clickLoadMore();this.sendStat(m);this.initPostFrame();this.loadNum();
this.upLoadImg();a("#iframe0").length||k.append('<iframe id="iframe0" name="iframe0" style="display:none"><script type="text/javascript">document.domain = "qq.com";\x3c/script></iframe>')},insertTempCommentFn:function(b,c){this.insertTempComment(c);this.options.$urlapi_mycomment.msgid=this.options.$urlapi_mycomment.first;this.options.columApi&&a("#mycon").hasClass("np-active")&&a("#myCowComment").hasClass("np-active")&&(this.options.$urlapi_mycomment.pageflag=0,this.loadMyComment());this.updateTime()},
init:function(){var b=this.options;a.getScript("http://mat1.gtimg.com/www/coral3.0/js/json.js",function(){b.cmt_array=cmtt_id.data.commentid;a.each(b.cmt_array,function(a,c){if(c.id==g)return b.cmt_class="",b.cmt_content=c.content,!1;b.cmt_class="np-tip-newpost1"})});a(parent.document).find("#commentIframe").css({"-webkit-transition":"height 0.6s ease",transition:"height 0.6s ease"});a(parent.document).find("#commentIframe1")&&a(parent.document).find("#commentIframe1").css({"-webkit-transition":"height 0.6s ease",
transition:"height 0.6s ease"});a("#mainBody").css("width","100%");b.commentNumbers=a(parent.document).find(".commentNumbers")?a(parent.document).find(".commentNumbers"):"";a("#allComments .post-list").length||a("#allComments").append("<ul class='post-list'></ul>");a("a").each(function(){a(this).attr("hideFocus","true")});if(parent.registerCoralEvent){parent.registerCoralEvent.source&&(b.columSource=parent.registerCoralEvent.source);parent.registerCoralEvent.subsource&&(b.columsubSource=parent.registerCoralEvent.subsource);
if(0==parent.registerCoralEvent.code||1==parent.registerCoralEvent.code)b.columCode=parent.registerCoralEvent.code;parent.registerCoralEvent.ownStyle&&a("head").append('<link href="'+parent.registerCoralEvent.ownStyle+'" rel="stylesheet" type="text/css" media="screen"/>');parent.registerCoralEvent.listHiden&&(a("#content").hide(),b.columApi=0);parent.registerCoralEvent.commentNums&&(b.homePageSize=parent.registerCoralEvent.commentNums);0==parent.registerCoralEvent.commentLink&&(b.columLink=parent.registerCoralEvent.commentLink);
2==parent.registerCoralEvent.commentLink&&(b.columLink=parent.registerCoralEvent.commentLink);0==parent.registerCoralEvent.commentHot&&(b.columHot=parent.registerCoralEvent.commentHot);parent.registerCoralEvent.commentHotNums&&(b.hotNums=parent.registerCoralEvent.commentHotNums);0==parent.registerCoralEvent.popupInfo&&(b.popupInfo="popupInfoOff");0==parent.registerCoralEvent.popupLink&&(b.popupLink="popupLinkOff");0==parent.registerCoralEvent.reportBtn&&(b.reportBtn=0);parent.registerCoralEvent.site&&
(b.siteName=parent.registerCoralEvent.site,"video"==parent.registerCoralEvent.site&&(b.huiyuan=1));parent.registerCoralEvent.site1&&(b.film=1);parent.registerCoralEvent.site2&&(b.client=1);if(top.location.host.match("coral.qq.com")){var c=top.location.host;null!=c.match(/(\w+)\.coral\.qq\.com/)&&(b.fetchUrl="http://"+c.match(/(\w+)\.coral\.qq\.com/)[1]+".coral.qq.com/")}else void 0!=parent.registerCoralEvent.site&&(b.fetchUrl="http://"+parent.registerCoralEvent.site+".coral.qq.com/")}},creatHtml:function(b,
c,e){var f=b.userinfo.head?b.userinfo.head:"http://mat1.gtimg.com/www/coral2.0/images/g.gif",d=b.userinfo.nick;b.content.replace(/\n/g,"<br />");b.userinfo.region.replace(/:/g," ");c=c?c:"";var p="",l="",w="",n="comment_",C="",g="popClick",h="v_qq_com.comment";1==this.options.film&&(h="film_direct.comment");1==this.options.client&&(h="service.comment");"msg"==e&&(n="msg_",p="");"top"==e&&(n="top_",p="topIco np-label-digest",l="topAll");0==b.rep&&(w="topno");0<b.hotscale?C="":(b.userinfo.userid!=a.cookie("uid")&&
this.options.reportBtn&&(C="<a href='javascript:void(0)' class='np-btn np-btn-report report' id='report_"+n+b.id+"'>\u4e3e\u62a5</a>"),p="");var k=this.options.popupInfo;10001==b.replyuserid&&(g="");var q="",m="",r="";if(b.rep||b.repnum)r=this.creatPostLink(b);b.rep&&"top"!=e&&(m="(<em>"+b.rep+"</em>)");if(""!=b.content||0!=b.rep||0!=b.isdeleted||void 0!=b.picture){var u=e="",B="",D="",E="";1==this.options.huiyuan&&(1==b.userinfo.hwvip&&(e="hyy",u="huiyuan p"+b.userinfo.hwlevel),1==b.replyhwvip&&
(E="hyy",D="huiyuan p"+b.replyhwlevel),1==this.options.client||"none"==b.classNone)&&(B="vhidden");if(1==b.isdeleted)q+='<li class="np-post" id="'+n+b.id+'">',q=q+('<img class="np-avatar" src="'+f+'"alt="\u5934\u50cf"/>')+'<div class="np-post-body">',q+='<div class="np-post-header">',q+='<a href="javascript:void(0)" class="np-user">'+d+"</a>",q+=0==b.parent?" ":'<a href="javascript:void(0)" post_uid = "'+b.replyuserid+'" class="replywho np-icon-reply-weak np-user '+g+'" style="display:'+b.classNone+
'">'+b.replyuser+"</a>",q+='<span class="np-time" data="'+b.time+'" >'+this.formatTime(b.time)+"</span>",q+="</div>",q+='<div class="np-post-content padding-b"><p>\u6b64\u8d34\u5df2\u88ab\u7528\u6237\u5220\u9664</p></div>',q+="</div>",q+='<ul class="children"></ul>',q+="</li>";else if(2==b.checkstatus&&0!=b.rep)q+="<li class='postHide' id="+n+b.id+"><ul class='children'></ul></li>";else{var z="",F="";if(void 0!=b.picture&&b.picture.length){for(var z=z+('<div><ul class="list_w100" id="pic_'+b.id+'" >'),
x=0,G=b.picture.length;x<G;x++)F=b.picture[x].width>b.picture[x].height?"height=100":"width=100",z+='<li class="list_item"><a href="javascript:void(0)" class="figure"><img data-order="'+x+'" data-total="'+G+'" data-width="'+b.picture[x].width+'" data-height="'+b.picture[x].height+'" '+F+' class="np-con-img" src="'+b.picture[x].url+'/100" /></a></li>';z+="</ul></div>"}q+='<li class="np-post '+c+" "+p+" "+l+" "+w+' " id="'+n+b.id+'"><div class="np-tip-newpost"></div><img class="np-avatar '+k+'" post_uid ="'+
b.userinfo.userid+'" src="'+f+'"alt="\u5934\u50cf"  onerror="errorImg(this)"><div class="np-post-body"><div class="np-post-header">'+C+'<span class="'+e+'"><a href="javascript:void(0)" title="'+d+'" class="np-user '+k+' " post_uid = "'+b.userinfo.userid+'">'+d+'</a><a href="http://film.qq.com/vip.html?ptag='+h+'" target = "_blank" class="'+u+'" title="\u4f1a\u5458\u5c0a\u4eab\u7ea2\u540d\u7279\u6743"></a></span>'+(0==b.parent?'<a href="javascript:void(0)" class="replywho np-icon-reply-weak np-user" style="display:none">'+
b.replyuser+"</a>":'<span class="'+E+" "+B+'"><a href="javascript:void(0)" title="'+b.replyuser+'" post_uid = "'+b.replyuserid+'" class="replywho np-icon-reply-weak np-user '+g+' " style="display:'+b.classNone+'">'+b.replyuser+'</a><a href="http://film.qq.com/vip.html?ptag='+h+'" target = "_blank" class="'+D+'"></a></span>')+'<span class="np-time" data="'+b.time+'" >'+this.formatTime(b.time)+'</span></div><div class="np-post-content"><p>'+b.content.replace(/\n/g,"<br />")+"</p></div>"+z+'<div class="np-post-footer"><a href="javascript:void(0)" class="np-btn np-btn-upvote upvote" id=upvote_'+
b.id+">(<em>"+b.up+'</em>)</a><a href="javascript:void(0)" class="np-btn np-btn-cvote cpvote '+this.options.cmt_class+'" id=cpvote_'+b.id+">"+this.options.cmt_content+"(<em>"+b.poke+'</em>)</a><a href="javascript:void(0)" class="np-btn np-btn-reply reply">\u56de\u590d'+m+"</a>"+("topno"!=w&&"topAll"==l?r:"")+'<a href="javascript:void(0)" class="np-btn np-btn-newreply"></a></div></div><ul class="children"></ul></li>'}return q}},loadCommentNum:function(){var b=this,c=this.options;a.ajax({url:c.fetchUrl+
"article/"+g+"/commentnum",dataType:"jsonp",jsonpCallback:"myHotcommentNum",beforeSend:function(){b._hotTimer0=(new Date).getTime()},success:function(a){0==a.errCode&&(c.commentNumbers.html(a.data.commentnum),c.$commentTotleNum.html("<span>"+a.data.commentnum+"\u6761\u8bc4\u8bba</span>"))}})},makeCommentList:function(){var b=this,c=this.options;1==c.columLink?c.$commentTotleNum.attr("href",c.fetchUrl+g):(c.$commentTotleNum.attr("href","javascript:void(0)"),c.$commentTotleNum.removeAttr("target"),
c.$commentTotleNum.css("cursor","default"),c.$commentTotleNum.css("text-decoration","none"));2==c.columLink&&(a("#globalNav h1").hide(),a("#globalNav").css("border-bottom","none"));a(parent.document.getElementById("cmtNum"))&&a(parent.document.getElementById("cmtNum")).attr({href:c.fetchUrl+g,target:"_blank"});c.columApi&&b.loadMore();c.$loadMore.find("span").unbind().bind("click",function(){a("#loadMore>span").hide();a("#loadMore>em").addClass("np-load-more-loading").show();b.loadMore(c.lastId);
0>=c.$loadMore.data("loadMoreNume")-c.homePageSize?(c.$loadMore.hide(),c.$loadMore.data("loadMoreNume",0)):c.$loadMore.data("loadMoreNume",c.$loadMore.data("loadMoreNume")-c.homePageSize);sendClientStat(m,1,g,"clk_allcomment_more")})},hotList:function(){var b=this,c=this.options,e=c.fetchUrl+"article/"+g+"/hotcomment?reqnum="+c.hotNums;c.columHot&&a.ajax({url:e,dataType:"jsonp",jsonpCallback:"myHotcommentList",beforeSend:function(){b._hotTimer0=(new Date).getTime()},success:function(c){if(0==c.errCode){var d=
(new Date).getTime();if(0!=c.data.commentid.length){var e=c.data.commentid.length;a.each(c.data.commentid,function(d,w){a("#allComments .post-list").prepend(b.creatHtml(c.data.commentid[e-d-1],0,"top"))});a.each(a("#allComments li.topAll"),function(b,c){b==e-1&&(a(this).addClass("noborder"),a(this).after('<li class="np-title-new">\u6700\u65b0\u8bc4\u8bba</li>'))});a("#allComments .post-list").prepend('<li class="np-title-hot">\u70ed\u95e8\u8bc4\u8bba</li>');b.conHeight(5);setTimeout(function(){b.iframeHeight()},
600)}}Qoss("zrpl",b._hotTimer0,{1:b._hotTimer0+1,2:d,3:d},100)}})},tabsComment:function(){var b=this,c=this.options;a("#mycon").unbind().click(function(){a(this).addClass("np-active");a("#mytips").removeClass("np-active");c.$myTips.hide();c.$myCons.show();0==a("#my-notification-list li").length&&(setTimeout(function(){b.loadMyComment()},500),a("#myuserInfo").hide());sendClientStat(m,1,g,"clk_mycomment");b.iframeHeight()});a("#mytips").unbind().click(function(){a(this).addClass("np-active");a("#mycon").removeClass("np-active");
c.$myTips.show();c.$myCons.hide();0==a("#my-message-list li").length&&b.loadMyMessage();sendClientStat(m,1,g,"clk_notice");b.iframeHeight()});""!=c.order&&(a("#order a").removeClass("np-active"),a("#order a[data-sort="+c.order+"]").addClass("np-active"));a("#order a").unbind().click(function(){"time"==a(this).attr("data-sort")?sendClientStat(m,1,g,"clk_order_time"):sendClientStat(m,1,g,"clk_order_hot");a(this).hasClass("np-active")||(a("#order a").removeClass("np-active"),a(this).addClass("np-active"),
a("#allComments .tipInfo").addClass("waitting").html("").show(),c.order="time"!=a(this).attr("data-sort")?a(this).attr("data-sort"):"",a("#allComments .post-list").html(""),a("#allComments .waitting").show(),c.$loadMore.hide(),"quality"!=c.order&&setTimeout(function(){b.hotList()},200),setTimeout(function(){b.loadMore(0,1)},500))})},loadMore:function(b,c){function e(){0==a("#allComments li").length&&a("#allComments").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show();
a("#allComments .post-list").length||a("#allComments").append("<ul class='post-list'></ul>")}var f=this,d=this.options;b=b||0;var p=d.homePageSize;b&&(p=20);a.ajax({url:d.fetchUrl+"article/"+g+"/comment?commentid="+b+"&reqnum="+p+"&tag="+d.order,dataType:"jsonp",beforeSend:function(){f._latestTimer0=(new Date).getTime()},error:e,jsonpCallback:"mainComment",success:function(c){if(0==c.errCode){d.lastId=c.data.last;var n=(new Date).getTime();c.data.retnum<c.data.reqnum||c.data.total<=d.homePageSize?
(a("#loadMore>span").hide(),a("#loadMore>em").removeClass("np-load-more-loading").show()):(a("#loadMore>span").show(),a("#loadMore>em").hide());d.$showNum.data("maxID",c.data.maxid);l(c);f.iframeHeight();b||(c.data.reqnum<c.data.total&&0<a("#allComments li").length&&d.$loadMore.show(),d.$commentTotleNum.html("<span>"+c.data.total+"\u6761\u8bc4\u8bba</span>"),d.commentNumbers.html(c.data.total),a(parent.document.getElementById("cmtNum"))&&a(parent.document.getElementById("cmtNum")).html(c.data.total),
a(parent.document.getElementById("cmtNum2"))&&a(parent.document.getElementById("cmtNum2")).html(c.data.total))}else e();0==a("#allComments li").length&&d.$loadMore.hide();Qoss("zxpl",f._latestTimer0,{1:f._latestTimer0+1,2:n,3:n},100)}});var l=function(b){b.data.commentid.length||0!=a("#allComments li").length?a("#allComments").children(".tipInfo").hide():(""!=d.order&&1!=c&&a("#order span[data-sort=time]").trigger("click"),"quality"==d.order?a("#allComments").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u70ed\u8bc4").show():
a("#allComments").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show(),d.$loadMore.hide());a("#allComments .post-list").length||a("#allComments").append("<ul class='post-list'></ul>");a.each(b.data.commentid,function(b,c){0==c.parent||0==a("#comment_"+c.parent).length?(0==a("#comment_"+c.parent).length&&0!=c.parent?c.classNone="none":c.classNone="",a("#allComments .post-list").append(f.creatHtml(c))):(a("#comment_"+c.parent).hasClass("postHide")?c.classNone="none":
c.classNone="",a("#comment_"+c.parent+">ul.children").append(f.creatHtml(c)))});a("#allComments .post-list .postHide").find(".replywho:first").hide();setTimeout(function(){f.conHeight()},500);setTimeout(function(){f.iframeHeight()},600)}},blueLine:function(b){setTimeout(function(){a(b+">.np-tip-newpost").animate({opacity:"0"},1E4);setTimeout(function(){a(b+">.np-avatar").animate({left:"0px"},400);a(b+">.np-post-body").animate({"padding-left":"10px"},400);a(b).removeClass("blueflag")},8E3)},5E3)},
probeEvent:function(){var b=this,c=this.options,e=function(){c.$tabFlag?a.ajax({url:"http://sync.coral.qq.com/t/"+g,dataType:"jsonp",jsonpCallback:"propNum",success:function(a){a>c.$realtimeComments&&0!=a&&(c.$realtimeComments=a,b.loadNew());setTimeout(function(){e()},3E4)},error:function(){setTimeout(function(){e()},3E4)}}):setTimeout(function(){e()},3E4);b.updateTime()};e()},loadNum:function(){var b=this.options,c=a.cookie("uid"),e="http://sync.coral.qq.com/u/"+c+"?platform="+b.siteName;if(/^\d+$/.test(c+
"")){var f=function(){b.$tabFlag&&a.cookie("uin")&&1E4<parseInt(c)?a.ajax({url:e,dataType:"jsonp",jsonpCallback:"userNum",success:function(b){0<b?a("#popMsg").html(b).show():a("#popMsg").html("").hide();setTimeout(function(){f()},3E4)},error:function(){setTimeout(function(){f()},3E4)}}):setTimeout(function(){f()},3E4)};f()}},loadNew:function(){var b=this,c=this.options;a.ajax({url:c.pfetchUrl+"article/"+g+"/sync?lastid="+c.$showNum.data("maxID"),dataType:"jsonp",jsonpCallback:"newComment",timeout:3E4,
success:function(e){b.options.$nowDate=1E3*e.info.time;if(0==e.errCode&&0!=e.data.length){e.data.maxid&&c.$showNum.data("maxID",e.data.maxid);a.each(e.data.commentid,function(e,d){if(0==a("#comment_"+d.id).length){if(2!=d.checkstatus){var p=c.$commentTotleNum.children("span").html();c.$commentTotleNum.children("span").html(parseInt(p)+1);c.commentNumbers.html(parseInt(p)+1)}0==d.parent?d.userinfo.userid!=a.cookie("uid")&&(a("#hiddenCon").prepend(b.creatHtml(d)),p=a("#hiddenCon li"),a.each(p,function(b,
c){a(c).addClass("blueflag")})):a.each(c.$allComments.find("li"),function(c,e){if(d.userinfo.userid!=a.cookie("uid")&&"comment_"+d.parent==e.id){void 0==a("#"+e.id).data("num")&&a("#"+e.id).data("num",0);if(a("#comment_"+d.parent).hasClass("undis")){var f=a("#comment_"+d.parent).parents("li:not(.undis):first");f.data("num",Number(f.data("num"))+1);var p=f.data("num")+"\u6761\u65b0\u56de\u590d",f=f.find(".post-footer:first>em.newcoment")}else a("#"+e.id).data("num",Number(a("#"+e.id).data("num"))+
1),p=a("#"+e.id).data("num")+"\u6761\u65b0\u56de\u590d",f=a(this).find(".post-footer:first>em.newcoment");f.html(p);f.show();a(e).find("ul:first").prepend(b.creatHtml(d,"undis"))}});a("#hiddenCon").html()&&d.parent&&(p=a("#hiddenCon li"),a.each(p,function(c,e){"comment_"+d.parent==e.id&&a(e).children(".children").append(b.creatHtml(d))}))}});if(e=a("#hiddenCon li").not(a(".hide")).length)a("#showNum span").html("<em>"+e+"</em> \u6761\u65b0\u8bc4\u8bba"),a("#showNum").show().animate({height:"30px"},
"slow",function(){b.iframeHeight()});a("#showNum").unbind().bind("click",function(){a("#allComments ul:first").prepend(a("#hiddenCon").html());a("#hiddenCon .blueflag").each(function(c,d){var e=a(this).attr("id");b.blueLine("#"+e)});a("#allComments li.temporary").remove();a("#hiddenCon").html("");a(this).hide();a("#allComments .tipInfo").hide();b.iframeHeight();c.newsNum=0;sendClientStat(m,1,g,"clk_newcomment_notice")});b.updateTime()}},error:function(a,b,c){"timeout"==b&&setTimeout(function(){loadNewHtml()},
5E3)}})},changeTab:function(){var b=this.options;a(document).bind({"show.visibility":function(){b.$tabFlag=!0},"hide.visibility":function(){b.$tabFlag=!1}})},bindFooterEvent:function(b){var c=this,e=this.options,f=a(".pop_reply"),d=a(".pop_reply a.submit"),p=a(".pop_reply textarea");b.delegate(".reply","click",function(e){e=e||window.event;var w=a(this).parents("li.np-post").attr("id");d.attr("id","pop_"+w);p.attr("id","pop_text_"+w);var n=a(this).closest(".np-post-body").next(".children");n.find(".np-reply-box-footer a").removeClass("submitOn").addClass("submit").html("\u56de\u590d");
n.find("textarea").val("");e.stopPropagation();n.has(".pop_reply").length&&"public_reply"==n.children().first().attr("id")?n.children(".pop_reply").is(":visible")?(n.children(".pop_reply").find(".commtSub").hide(),n.children(".pop_reply").slideUp("10",function(){c.iframeHeight()})):(n.children(".pop_reply").find(".commtSub").show(),n.children(".pop_reply").slideDown("100",function(){c.iframeHeight()}),setTimeout(function(){n.children(".pop_reply").find("textarea").focus()},200)):(b.find(".pop_reply").slideUp("10",
function(){a(this).remove();c.iframeHeight()}),n.prepend(f.clone()),n.children(".pop_reply").slideDown("100",function(){c.iframeHeight()}),setTimeout(function(){n.children(".pop_reply").find("textarea").focus()},200));a(".children .add_file").on("change",function(){c.upLoadchange(a(this))});c.iframeHeight()});b.delegate(".pop_reply","click",function(a){});b.delegate(".submit","click",function(){var b=c.getLoginStatus(),d=a(this).closest("[tid]").attr("tid");e.replylistId=a(this).attr("id").split("_")[2];
0!=b?(c.checkAndPublish(this.id,d),e.$insertFlag=this.id.split("_")[1],sendClientStat(m,1,g,"pub_reply")):c.showLoginLayer()});b.delegate(".pop_user_login","click",function(){c.showLoginLayer()});a("#my-notification").delegate(".upvote","click",function(){alert("\u81ea\u5df1\u4e0d\u80fd\u9876\u81ea\u5df1");return!1});b.delegate(".upvote","click",function(){var b=a(this).attr("id"),c=b.split("_")[1];e.uptId=b;if(a(this).hasClass("np-btn-active"))return!1;if(a.cookie("uid")==a(this).parent().parent().find(".np-user").attr("post_uid"))return alert("\u81ea\u5df1\u4e0d\u80fd\u9876\u81ea\u5df1"),
!1;b=g;a(this).closest("[tid]").length&&(b=a(this).closest("[tid]").attr("tid"));a.ajax({url:e.wfetchUrl+"article/comment/up/to/"+c+"?targetid="+b,dataType:"jsonp",jsonpCallback:"ding",cache:!0,success:function(a){sendClientStat(m,1,g,"pub_up")}});c=a(this).find("em");b=parseInt(c.text());c.html(b+1);a(this).addClass("np-btn-active")});b.delegate(".cpvote","click",function(){var b=a(this).attr("id"),c=b.split("_")[1];e.uptId=b;if(a(this).hasClass("np-btn-active"))return!1;if(a.cookie("uid")==a(this).parent().parent().find(".np-user").attr("post_uid"))return alert("\u81ea\u5df1\u4e0d\u80fd\u8e29\u81ea\u5df1"),
!1;b=g;a(this).closest("[tid]").length&&(b=a(this).closest("[tid]").attr("tid"));a.ajax({url:e.wfetchUrl+"article/comment/up/to/"+c+"?targetid="+b+"&uptype=1",dataType:"jsonp",jsonpCallback:"cai",cache:!0,success:function(a){sendClientStat(m,1,g,"pub_up")}});c=a(this).find("em");b=parseInt(c.text());c.html(b+1);a(this).addClass("np-btn-cactive")});b.delegate(".popClick","click",function(){a(this).attr("post_uid");var b=a(this).attr("post_uid");c.popupIframeLayer(b);sendClientStat(m,1,g,"clk_head")});
b.delegate(".newcoment","click",function(){var b=a(this).attr("id").split("_")[1];a("#comment_"+b+">ul.children li .newcoment").hide();a("#comment_"+b+">ul.children li.undis").removeClass("undis").addClass("blueflag");c.iframeHeight();a(this).hide();a("#comment_"+b).data("num",0);a("#comment_"+b+">ul.children li.blueflag").each(function(b,d){c.blueLine("#"+a(this).attr("id"))});sendClientStat(m,1,g,"clk_newreply_notice")});b.delegate(".spreadMoreBtn","click",function(){a(this).prev().css("height",
"");a(this).hide();c.iframeHeight()});a(top.window.document.body).find("#picPlayIframe").length||a(top.window.document.body).append('<iframe id="picPlayIframe0" src ="http://www.qq.com/coral/coralBeta3/coralImgDom3.0.htm" allowTransparency="true"  frameborder="0" scrolling="no" style="display:none;width:100%;height:100%;z-index:999999;position:fixed;_position:absolute;*+position:fixed;top:0px;left:0px;border:none;overflow:hidden;"></iframe>');b.delegate(".np-con-img","click",function(){a(this).attr("data-order");
a(top.window).height();a(top.window).width();a(this).attr("data-height");a(this).attr("data-width");a(this).attr("src");classTypeNext=classTypePrve="";var b=a(this).closest(".list_w100").attr("id");a(top.window.document.body).find("#picPlayIframe").length?(a(top.window.document.body).find("#picPlayIframe").show(),a(top.window.document.body).find("#picPlayIframe").attr({"data-id":b,"data-order":a(this).attr("data-order"),"data-total":a(this).attr("data-total"),"data-flag":"main"})):(a(top.window.document.body).find("#picPlayIframe0").remove(),
b='<iframe  id="picPlayIframe" data-flag="main" data-id="'+b+'" data-order='+a(this).attr("data-order")+" data-total="+a(this).attr("data-total")+' src ="http://www.qq.com/coral/coralBeta3/coralImgDom3.0.htm?'+(new Date).getTime()+'" allowTransparency="true"  frameborder="0" scrolling="no" style="width:100%;height:100%;z-index:999999;position:fixed;_position:absolute;top:0px;left:0px;border:none;overflow:hidden;"></iframe>',a(top.window.document.body).append(b))})},showLoginLayer:function(){publicLoginEvent()},
onLogined:function(b,c,e){var f="",f=c.replace(/</g,"&lt;"),f=f.replace(/>/g,"&gt;"),d=this.options;r=(""+b).match(/[1-9][0-9]*/)[0]||getUin();b=e?e:"http://mat1.gtimg.com/www/coral2.0/images/g.gif";d.$loginFlag.data("userPic",e);d.$loginFlag.data("nick",c);d.$loginBtn.html("\u53d1\u8868\u8bc4\u8bba");d.$loginFlag.find("img").attr("src",b);d.$loginFlag.find("em").html(f);a("#loginFlag span:first").removeClass();a("#loginFlag span:first a").removeClass();d.$loginFlag.show();a("#my-message .tipInfo").show();
a(".pop_user_login").hide();a("#public_reply .np-btn-submit").html("\u56de\u590d");a(".np-reply-box-info").show();this.options.$loginFlag.data("userPic",e);this.options.$loginFlag.data("nick",c);a("#my-message-list").html("");a("#my-notification-list").html("");a("#loadCmtMore").hide();this.options.loginuin&&this.options.$top_textarea.focus();this.iframeHeight();d.$urlapi_mycomment.msgid="";d.$urlapi.pageflag="0";d.$urlapi_mycomment.pageflag="0";this.changeUid();d.centerFlag&&d.$myCowComment.trigger("click");
d.changeFlag&&(d.$myAllComment.trigger("click"),this.reportInit(),a("#tab2_myComments .tipInfo").removeClass("waitting").addClass("waitting").html("").show(),a("#tab2_myComments .np-load-more").hide())},loginOut:function(b){var c=this.options;r=null;b||this.options.$logoutTrigger.click();c.$loginFlag.data("userPic","undefined");c.$loginFlag.data("nick","undefined");c.$loginFlag.hide();a("#public_reply .np-btn-submit").html("\u767b\u5f55");c.$myAllComment.trigger("click");c.$loginBtn.html("\u767b\u5f55");
a(".np-reply-box-info").hide();a("#my-message-list").html("");a("#my-notification-list").html("");a("#loadCmtMore").hide();a("#loadMsgMore").hide();a.removeCookie("uid")},changeUid:function(){var b=this.options,c="v_qq_com.comment";1==this.options.film&&(c="film_direct.comment");1==this.options.client&&(c="service.comment");a.ajax({dataType:"jsonp",url:b.fetchUrl+"user/0?&source=0",success:function(e){0==e.errCode&&1==b.huiyuan&&(1==e.data.hwvip?(a("#loginFlag span:first").addClass("hyw"),a("#loginFlag span.hyw a").addClass("huiyuan"),
a("#loginFlag span.hyw a").attr("title","\u4f1a\u5458\u5c0a\u4eab\u7ea2\u540d\u7279\u6743"),a("#loginFlag .huiyuan").addClass("p"+e.data.hwlevel)):(a("#loginFlag span:first").addClass("hyw0"),a("#loginFlag span.hyw0 a").addClass("huiyuan0"),a("#loginFlag span.hyw0 a").attr("title","\u5f00\u901a\u4f1a\u5458\u5c0a\u4eab\u8bc4\u8bba\u7ea2\u540d\u7279\u6743")),a("#loginFlag .huiyuan").attr("href","http://film.qq.com/vip.html?ptag="+c))},error:function(a){}})},getLoginStatus:function(){return r?1:0},bindSubmitEvent:function(){var b=
this,c=this.options;c.$loginBtn.unbind().click(function(){getUin()&&"\u767b\u5f55"!=a(this).html()?(b.checkAndPublish(this.id),c.$insertFlag="comment"):b.showLoginLayer()})},bindDeleteEvent:function(){var b=this;a("#mainBody").delegate(".delete","click",function(c){var e=a(this),f="popdelete",d=e.attr("id").split("_")[1];getUin()?(a("#my-notification-list li.np-post:last").attr("id")=="post_"+d&&(f="popdeletee"),a("#my-notification-list li.np-post").css("z-index","1"),a(".popdeletee").remove(),a(".popdelete").remove(),
a("#post_"+d).css("z-index","100"),e.css("position","relative"),e.append('<div class="'+f+'"><h4>\u60a8\u786e\u5b9a\u8981\u6c38\u4e45\u5220\u9664\u6b64\u8bc4\u8bba\uff1f</h4><p><input class="cancel" type="button" value="\u53d6\u6d88" id="d_cancel"/><input class="confirm" type="button" value="\u786e\u5b9a" id="d_confirm"/></p></div>'),a("#d_confirm").click(function(){b.postData(e.attr("id"),e.closest("[tid]").attr("tid"))}),a("#d_cancel").click(function(){e.find("div").remove();e.css("position","relative")})):
b.showLoginLayer();c.stopPropagation()});h.unbind().bind("click",function(){a("#my-notification-list .delete div").remove()})},bindReportEvent:function(){var b=this,c=this.options,e=a(".np-report");a("#mainBody").delegate(".report","click",function(){var f=a(this);if(0!=b.getLoginStatus()){if(!a(this).find("em").length){a("#allComments .np-report").remove();a("#allComments li.np-post").css("z-index","1");a(this).parent().append(e.clone().show());var d=a(this).attr("id").split("report_")[1];a("#"+
d).css("z-index","100");a("#"+d).parents("li.np-post").css("z-index","100");a(this).attr("id").split("report_")[1]==a("#content li.np-post:last").attr("id")&&303>a("#content li.np-post:last .np-post-body:first").height()-37&&a("#content .np-report").css("top","-290px");a(this).attr("id").split("report_")[1]==a("#content li.np-post").eq(-2).attr("id")&&303>a("#content li.np-post:last .np-post-body:first").height()+a("#content li.np-post").eq(-2).find(".np-post-body:first").height()-37&&a("#content .np-report").css("top",
"-290px");a(this).attr("id").split("report_")[1]==a("#content li.np-post").eq(-3).attr("id")&&303>a("#content li.np-post:last .np-post-body:first").height()+a("#content li.np-post").eq(-2).find(".np-post-body:first").height()+a("#content li.np-post").eq(-3).find(".np-post-body:first").height()-37&&a("#content .np-report").css("top","-290px");a(this).parent().find(".close").bind("click",function(){f.parent().find(".np-report").remove();a("#content li.np-post").css("z-index","1")});a(this).parent().find(".np-report-cancel").bind("click",
function(){f.parent().find(".np-report").remove();f.parents(".np-post").trigger("mouseout");a("#content li.np-post").css("z-index","1")});a(this).parent().find("#impeach_desc").focus(function(){a(this).val("");a(this).css("color","#333")});a(this).parent().find(".np-report-submit").bind("click",function(){f.parent().find("input[name='impeach_content']:checked").length?b.postData(f.attr("id"),f.closest("[tid]").attr("tid")):(0==f.parent().find(".np-report h5").find("span").length&&f.parent().find(".np-report h5").append('<span id="RT">\u4f60\u5fc5\u987b\u9009\u62e9\u4e00\u9879\u624d\u80fd\u4e3e\u62a5!</span>'),
setTimeout(function(){a("#RT").remove()},2E3))});c.reportId=a(this).attr("id")}}else b.showLoginLayer()});a("#mainBody").delegate(".np-post-body","mouseover",function(b){a(this).find(".popClick").attr("post_uid")!=a.cookie("uid")&&(a(".report").hide(),a(this).find(".report:first").show(),b.stopPropagation())});a("#mainBody").delegate(".np-post-body","mouseout",function(b){a(this).find(".report em").length||a(this).find(".report:first").hide();b.stopPropagation()})},reportInit:function(){var b=this.options.$allComments.find("li.np-post .reportOn");
a.each(b,function(b,e){a(this).removeClass("reportOn");a(this).find("em").remove()})},isUpImg:function(b){var c=a("#"+b);return"+"!=c.find(".add_pic").text()?(c.find(".upImgInfo").length||c.find(".insert_piclist").append('<li style="padding-top:20px;color:red" class="upImgInfo">\u56fe\u7247\u6b63\u5728\u4e0a\u4f20\u4e2d\uff01</li>'),setTimeout(function(){c.find(".upImgInfo").fadeOut().remove()},3E3),!0):!1},checkAndPublish:function(b,c){var e=this.options,f=b.replace(/pop/,"pop_text"),f=a("#"+f),
d=b.split("_")[0];if("top"==d){if(this.isUpImg("insertPicList"))return!1;f=e.$top_textarea;sendClientStat(m,1,g,"pub_original")}else if(this.isUpImg("insertPicList_reply"))return;0==a.trim(f.val()).length||f.val()==e.topContentTips?this.pubCallback(b,{ret:1,error2show:"\u8bf7\u8f93\u5165\u5185\u5bb9\uff01"}):2E3<a.trim(f.val()).realLength()?alert("\u8d85\u8fc71000\u4e2a\u5b57\u4e86"):getUin()?("top"==d&&e.$loginBtn.addClass("np-btn-submit-loading"),this.postData(b,c)):this.showLoginLayer()},postData:function(b,
c){var e=this.options;this._pubTimer0=(new Date).getTime();var f=generateToken(getKey()),d=b.replace(/pop/,"pop_text"),p=b.split("_")[2],l=b.split("_")[0],w=b.split("_")[2];b.split("_");var n="",h;if("top"==l||"pop"==l)if("top"==l?h=a(".insert_piclist img"):"pop"==l&&(h=a("#"+b.replace(/pop_/,"")).find(".insert_piclist img")),0<h.length){for(var n=n+"[",k=0,m=h.length;k<m;k++)0<k&&(n+=","),n+=h.eq(k).attr("data");n+="]"}e.dataImgObj=n;h=a("input[name='impeach_content']:checked").length?a("input[name='impeach_content']:checked").val():
" ";k=a("#"+b).parent().find('input[name="impeach_desc"]').val();"top"==l?this.submitForm({targetid:g,type:1,format:"SCRIPT",callback:e.topCallback,content:a.trim(e.$top_textarea.val()),_method:"put",g_tk:f,code:1,source:e.columSource,subsource:e.columsubSource,picture:n}):"pop"==l?(a("#"+b).html("").removeClass("submit").addClass("np-btn-submit-loading"),this.submitForm({targetid:c||g,type:1,format:"SCRIPT",callback:e.popCallback,content:a.trim(a("#"+d).val()),_method:"put",g_tk:f,code:1,source:e.columSource,
subsource:e.columsubSource,picture:n},p)):"report"==l?this.submitForm({targetid:c||g,type:h,desc:k,enterapp:"web",_method:"put",commentid:w,format:"SCRIPT",g_tk:f,callback:e.reportCallback},l):"delete"==l&&this.submitForm({targetid:c||g,_method:"delete",format:"SCRIPT",g_tk:f,callback:e.deleteCallback},b)},submitForm:function(b,c){var e=this.options,f="",f=c?"report"==c||"msg"==c?"http://w.coral.qq.com/report/comment/0":"em"==c.split("_")[0]||"am"==c.split("_")[0]?e.wfetchUrl+"article/comment/up/to/"+
c.split("_")[1]:"delete"==c.split("_")[0]?"http://w.coral.qq.com/article/comment/"+c.split("_")[1]:e.wfetchUrl+"article/comment/to/"+c:e.wfetchUrl+"article/comment/";a("#post_iframe").length||k.append('<iframe id="post_iframe" name="post_iframe" style="display:none"><script type="text/javascript">document.domain = "qq.com";\x3c/script></iframe>');e=a("#_messageform").length?a("#_messageform").attr("action",f).empty():a('<form action="'+f+'" method="post" target="post_iframe" id="_messageform" style="display:none;"></form>').appendTo(k);
for(name in b)e.append(a('<input name="'+name+'" type="hidden" value="" />').val(b[name]));e.submit()},sendStat:function(a){sendClientStat(m,2,g,"coral"==a?"pgv_commentdetail":"pgv_articledetail")},pubCallback:function(b,c,e){var f=b.split("_")[0],d=this.options,p=this.options,l=this,g="\u8bc4\u8bba\u6210\u529f!",n=!0,h,k=function(a){switch(a){case 0:l.insertTempCommentFn(null,c);break;case 8:l.showLoginLayer();break;case 9:case 13:case 14:case 16:case 17:l.insertTempCommentFn(null,h);break;default:g=
"\u7cfb\u7edf\u51fa\u9519\u8bf7\u7a0d\u540e\u518d\u53d1"}},m={};"[]"!=d.dataImgObj&&""!=d.dataImgObj&&(m=jQuery.parseJSON(d.dataImgObj));if("top"==f)""!==a("#top_textarea").val()&&(a("#insertPicList .upimgbox").remove(),a("#insertPicList").hide()),c.ret?(g=c.error2show||"<b>\u56e7</b>... \u51fa\u9519\u4e86\uff01 ",n=!1,setTimeout(function(){p.$top_textarea.focus();p.$topReply.find("span.np-tip-error").html(g).fadeOut("fast")},2E3)):(h={data:{parent:"0",commentid:(new Date).getTime(),time:parseInt((new Date).getTime()/
1E3),content:""+l.encodeHTML(p.$top_textarea.val())+"",checktype:"0",picture:m}},k(c.errCode),p.$loginBtn.removeClass("np-btn-submit-loading")),p.$topReply.find("span.np-tip-error").html(g).fadeIn("fast"),n&&(p.$top_textarea.val(""),setTimeout(function(){p.$topReply.find("span.np-tip-error").hide();p.$topReply.find("span.fontsline").show()},2E3));else if("pop"==f){var f=b.replace(/pop_/,""),r=a("#"+f+">.children .tips"),q=a("#content").find(".pop_reply:visible .np-tip-error"),t=a("#content").find(".pop_reply:visible textarea"),
y=b.replace(/pop/,"pop_text");""!=a("#public_reply textarea").val()&&(a("#insertPicList_reply .upimgbox").remove(),a("#insertPicList_reply").hide());c.ret?(tips=c.error2show||"<b>\u56e7</b>... \u51fa\u9519\u4e86\uff01 ",r.html(tips).hide().fadeIn("slow"),setTimeout(function(){a("#"+y).focus();r.html("")},2E3)):(h={data:{parent:p.replylistId,commentid:(new Date).getTime(),time:parseInt((new Date).getTime()/1E3),content:l.encodeHTML(a(t).val()),checktype:"0",picture:m}},k(c.errCode),q.html(g).hide().fadeIn("slow"),
a("#content").find(".pop_reply:visible .np-reply-box-footer a").removeClass("submitOn").addClass("submit").html("\u56de\u590d"),setTimeout(function(){a(t).focus();q.html("")},2E3))}else"report"==f?(0==c.errCode?(a("#report_comment_"+c.data.commentid).html("").append("<em>24\u5c0f\u65f6\u5185\u7ed9\u60a8\u53cd\u9988\uff0c\u89c1\u6211\u7684\u725b\u8bc4</em>"),a("#report_top_"+c.data.commentid).html("").append("<em>24\u5c0f\u65f6\u5185\u7ed9\u60a8\u53cd\u9988\uff0c\u89c1\u6211\u7684\u725b\u8bc4</em>"),
a("#report_msg_"+c.data.commentid).html("").append("<em>24\u5c0f\u65f6\u5185\u7ed9\u60a8\u53cd\u9988\uff0c\u89c1\u6211\u7684\u725b\u8bc4</em>")):12==c.errCode?a("#"+p.reportId).html("").append("<em>\u60a8\u4eca\u5929\u4e3e\u62a5\u7684\u6761\u6570\u5df2\u8fbe\u4e0a\u9650</em>"):a("#"+p.reportId).html("").append("<em>\u8be5\u8bc4\u8bba\u5df2\u88ab\u4e3e\u62a5\u6216\u5904\u7406!</em>"),a("#"+p.reportId).addClass("np-btn-active"),a(".np-report").remove()):"delete"==f&&0==c.errCode&&a("#post_"+c.data.commentid).animate({height:"0px"},
"slow",function(){a(this).remove();l.iframeHeight()});e&&Qoss("hfpljk",this._pubTimer0,{3:e})},encodeHTML:function(a){var c="";if(0==a.length)return"";c=a.replace(/&/g,"&gt;");c=c.replace(/</g,"&lt;");c=c.replace(/>/g,"&gt;");c=c.replace(/ /g,"&nbsp;");c=c.replace(/\'/g,"&#39;");c=c.replace(/\"/g,"&quot;");return c=c.replace(/\n/g,"<br>")},insertTempComment:function(b){var c=b.data.commentid||"",e=b.data.content||"",f=b.data.parent||"",d=b.data.time||"",p=b.data.checktype||"",l=b.data.picture||"",
g="";b=this.options;r||getUin();var h=b.$loginFlag.find(".np-user").html(),k=b.$loginFlag.find("img").attr("src"),m="",A="",v=A=m="",q="";b.$loginFlag.find("span:first").hasClass("hyw")?(m=b.$loginFlag.find(".huiyuan").attr("class"),A=m.replace(/[^0-9]/ig,""),m=1,A=parseInt(A),v="hyy",q="huiyuan p"+A):b.$loginFlag.find("span:first").hasClass("hyw0")&&(v="hyy0",q="huiyuan0");var g="",t=e.replace("<script>","&lt;script&gt;"),t=t.replace("\x3c/script>","&lt;/script&gt;"),y=g="";if(void 0!=l&&l.length){for(var g=
'<div><ul class="list_w100" id="pic_'+c+'">',u=0,B=l.length;u<B;u++)y=l[u].width>l[u].height?"height=100":"width=100",g+='<li class="list_item"><a href="javascript:void(0)" class="figure"><img data-order="'+u+'" data-total="'+B+'" '+y+' class="np-con-img" data-width = "'+l[u].width+'" data-height = "'+l[u].height+'" src="'+l[u].url+'/100" /></a></li>';g+="</ul></div>"}1==p?(e={id:c,parent:0,time:d,content:e,up:0,poke:0,userinfo:{userid:a.cookie("uid"),commentnum:"",upnum:0,nick:h,head:k,region:"",
hwvip:m,hwlevel:A},picture:l},g=this.creatHtml(e,"blueflag",b.$insertFlag)):g='<li class="np-post temporary blueflag" id="comment_'+c+'"><div class="np-tip-newpost"></div><img class="np-avatar" src="'+k+'" alt="\u5934\u50cf"><div class="np-post-body"><div class="np-post-header"><span class="'+v+'"><a href="javascript:void(0)" class="np-user">'+h+'</a><a href="http://film.qq.com/vip.html?ptag=film_direct.comment" target="_blank" class="'+q+'" title="\u4f1a\u5458\u5c0a\u4eab\u7ea2\u540d\u7279\u6743"></a></span><span class="np-time">\u521a\u521a</span></div><div class="np-post-content"><p>'+
t+"</p></div>"+g+"</div></li>";if(0!=parseInt(f)){if(a("#top_"+f).length||a("#comment_"+f).length||a("#post_"+f).length||a("#msg_"+f).length)a("#top_"+f+">ul.children").prepend(g).children("div.pop_reply").hide(),a("#comment_"+f+">ul.children").prepend(g).children("div.pop_reply").hide(),a("#post_"+f+">ul.children").children("div.pop_reply").hide(),a("#msg_"+f+">ul.children").prepend(g).children("div.pop_reply").hide(),this.iframeHeight()}else a("#allComments .tipInfo:visible")&&a("#allComments .tipInfo").hide(),
b.$allComments.find(".np-title-new").length?(b.$allComments.find(".np-title-new").after(g),f=a("#comment_"+c).offset().top+a(top.document).scrollTop(),a(top.document.body).animate({scrollTop:f},800),a(top.window).scrollTop(f)):b.$allComments.find(".post-list").prepend(g),this.iframeHeight();"post"!=b.$insertFlag?this.blueLine("#"+b.$insertFlag+"_"+c):this.blueLine("#comment_"+c)},iframeHeight:function(){var b=a("#mainBody").height();a(parent.document.body).find("#commentIframe1").length?a(parent.document.body).find("#commentIframe1").height(b):
a(parent.document.body).find("#commentIframe").height(b);parent.registerCoralEvent&&parent.registerCoralEvent.iframeHeight&&parent.registerCoralEvent.iframeHeight()},popupIframeLayer:function(b){a(top.document.body).append('<iframe src ="http://www.qq.com/coral/coralBeta3/coralPopDom3.0.htm" allowTransparency="true"  frameborder="0" scrolling="no" style="width:100%;height:100%;z-index:999999;position:fixed;_position:absolute;*+position:fixed;_left:100px;top:0px;left:0px;border:none;overflow:hidden;" id="np-pop-iframe" data-id = '+
b+"></iframe>");/msie 6/i.test(navigator.userAgent)&&0!=a(top.document.body).find("#np-pop-iframe").length&&a(top.document.body).find("#np-pop-iframe").css("position","absolute")},bindOtherEvents:function(){var b=this,c=this.options;c.$top_textarea.height(60);c.$top_textarea.css("padding","10px");a("#np-reply-box").delegate("a.change","click",function(){c.changeFlag=1;b.showLoginLayer()});c.$top_textarea.focus(function(){a(this).parent().parent().addClass("checkon")});c.$top_textarea.blur(function(){a(this).parent().parent().removeClass("checkon")});
c.$myCowComment.unbind().bind("click",function(){var e=b.getLoginStatus();sendClientStat(m,1,g,"clk_myniuping");if(0!=e)if(a(this).addClass("np-active"),c.$myAllComment.removeClass("np-active"),c.$allComments.hide(),c.$myComments.show(),a("#mytips").trigger("click"),"none"!=a("#popMsg").css("display"))b.loadMyMessage(),a("#my-message .tipInfo").hide(),a("#popMsg").html("").hide(),a("#mytips").trigger("click");else if(a(this).hasClass("np-active"))""==a("#popMsg").html()?0<=a("#my-message-list li").length||
a("#popMsg").html("").hide():(a("#my-message-list").html(""),a("#popMsg").html("").hide(),b.loadMyMessage());else{if(a(this).hasClass("np-active"))"none"!=a("#popMsg").css("display")&&(a("#my-message-list").html(""),b.loadMyMessage(),a("#popMsg").html("").hide());else if(a("#my-message-list li").length)"none"!=a("#popMsg").css("display")&&(a("#my-message-list").html(""),a("#popMsg").html("").hide(),b.loadMyMessage());else return;b.checkAndPublish(this.id)}else c.centerFlag=1,a("#my-message .tipInfo").hide(),
a("#my-notification .tipInfo").hide(),b.showLoginLayer()});c.$myAllComment.unbind().bind("click",function(){a(this).addClass("np-active");c.$myCowComment.removeClass("np-active");c.$allComments.show();c.$myComments.hide();b.iframeHeight()})},formatTime:function(a){var c=this.options.$nowDate/1E3-a;if(1>c)return"\u521a\u521a";if(60>c)return Math.floor(c)+"\u79d2\u949f\u524d";if(3600>c)return Math.floor(c/60)+"\u5206\u949f\u524d";if(86400>c)return Math.floor(c/3600)+"\u5c0f\u65f6\u524d";if(604800>c)return Math.floor(c/
86400)+"\u5929\u524d";a=new Date(1E3*a);c=a.getFullYear()+"-";c+=a.getMonth()+1+"-";return c+=a.getDate()},conHeight:function(b){var c=a("#allComments .np-post .np-post-content[data-height!=5]"),e=24;a("#allComments .np-post .np-post-content").length&&(/px/.test(c.css("line-height"))&&(e=c.css("line-height").split("px")[0]),2==b&&(c=a("#my-message-list .np-post .np-post-content[data-height!=5] p")),3==b&&(c=a("#my-notification-list .np-post .np-post-content[data-height!=5]")),5==b&&(c=a("#allComments .topIco .np-post-content[data-height!=5]")),
c.each(function(b,c){a(this).attr("data-height","5");a(this).height()>6*e&&!a(this).next(".spreadMoreBtn").length&&(a(this).css({height:5*e,overflow:"hidden"}),a(this).after('<a href="javascript:void(0)" class="spreadMoreBtn np-btn np-btn-spread"><i class="np-icon np-icon-spread"></i></a>'))}))},updateTime:function(){var b=this;this.options.$content.find(".uptime").each(function(){a(this).html(b.formatTime(a(this).attr("date")))});a("#my-message").find(".time").each(function(){a(this).html(b.formatTime(a(this).attr("date")))});
a("#my-notification").find(".post-time span").each(function(){a(this).html(b.formatTime(a(this).attr("date")))});a("#hiddenCon").find(".uptime").each(function(){a(this).html(b.formatTime(a(this).attr("date")))})},subString:function(a,c){a=a||"";var e=/[^\x00-\xff]/g;if(a.replace(e,"mm").length<=c)return a;for(var f=Math.floor(c/2);f<a.length;f++)if(a.substr(0,f).replace(e,"mm").length>=c)return a.substr(0,f)+"...";return a},myCreateHtml:function(b,c,e){var f=this.options,d="",g="",l="",h="msg_",n=
"v_qq_com.comment";1==this.options.film&&(n="film_direct.comment");var k=f.popupInfo,m="",r="",h="";0!=b.repnum&&(h="");if(b.content)var v="<p>"+b.content.replace(/\n/g,"<br />")+h+"</p>";var q="";if(void 0!=b.picture&&b.picture.length){for(var v=v+('<div><ul class="list_w100" id="pic_'+b.id+'">'),t=0,y=b.picture.length;t<y;t++)q=b.picture[t].width>b.picture[t].height?"height=100":"width=100",v+='<li class="list_item"><a href="javascript:void(0)" class="figure"><img data-order="'+t+'" data-total="'+
y+'" data-width="'+b.picture[t].width+'" data-height="'+b.picture[t].height+'" '+q+' class="np-con-img" src="'+b.picture[t].url+'/100" /></a></li>';v+="</ul></div>"}if("message"==c){"4"==b.tipstype&&b.userlist&&(0<b.userlist.length&&(a.each(b.userlist,function(a,b){1==f.huiyuan&&1==b.hwvip&&(m="hyy",r="huiyuan p"+b.hwlevel);0<a&&(l+="\u3001");l+='<span class="'+m+'"><a href="javascript:void(0)" post_uid='+b.userid+'  class="np-user '+k+'">'+b.nick+'</a><a href="http://film.qq.com/vip.html?ptag='+
n+'" target = "_blank" class="'+r+'"></a></span>'}),b.userlist.length<b.up&&(l+="\u7b49")),d='<li class="post np-post '+e+'" id="msg_'+b.id+'" tid="'+b.targetinfo.targetid+'"><div class="np-post-header"><span class="np-avatar np-avatar-upvote"></span>'+l+b.up+'\u9876\u4e86\u4f60\u7684\u8bc4\u8bba\uff1a<span class="np-text-strong">'+(""==a.trim(b.content)?"\u53d1\u8868\u4e86\u4e00\u5f20\u56fe\u7247":this.subString(b.content,46))+h+'</span><span class="np-time" date="'+b.tipstime+'">'+this.formatTime(b.tipstime)+
'</span></div><div class="np-post-content"><a class="np-link-weak" target="_blank" href="'+(b.targetinfo?b.targetinfo.url:"")+'">'+b.targetinfo.title+'</a></div><div class="np-post-footer"></div><ul class="children"></ul></li>');"8"==b.tipstype&&(1==f.huiyuan&&1==b.userinfo.hwvip&&(m="hyy",r="huiyuan p"+b.userinfo.hwlevel),b.userinfo.head&&(g=b.userinfo.head.replace(/140/,"40")||"http://t0.qlogo.cn/mbloghead/01676c4b10bbdb6f2618/50"),d+='<li class="np-post '+e+'" id="msg_'+b.id+'" tid="'+b.targetinfo.targetid+
'"><div class="np-post-body"><div class="np-post-header"><img class="np-avatar '+k+'"  post_uid="'+b.userinfo.userid+'" src="'+g+'" alt="\u5934\u50cf"><span class="'+m+'">\u4f60\u7684\u597d\u53cb<a href="javascript:void(0)" class="np-user '+k+'" post_uid="'+b.userinfo.userid+'">'+b.userinfo.nick+'</a><a href="http://film.qq.com/vip.html?ptag='+n+'" target = "_blank" class="'+r+'"></a></span>\u53c2\u4e0e\u4e86\u540c\u7bc7\u5185\u5bb9\u7684\u8ba8\u8bba<span class="np-text-strong"></span><span class="np-time" date="'+
b.tipstime+'">'+this.formatTime(b.tipstime)+'</span><a class="np-btn np-btn-report report" id="report_msg_'+b.id+'">\u4e3e\u62a5</a></div><div class="np-post-content">'+v+'<a class="np-link-weak" target="_blank" href="'+(void 0!=b.targetinfo?b.targetinfo.url:"")+'">'+b.targetinfo.title+'</a></div><div class="np-post-footer"><a href="javascript:void(0)" class="np-btn np-btn-upvote upvote" id="am_'+b.id+'">(<em>'+b.up+'</em>)</a><a href="javascript:void(0)" class="np-btn np-btn-reply reply">\u56de\u590d</a></div></div><ul class="children"></ul></li>');
"3"==b.tipstype&&(1==f.huiyuan&&1==b.userinfo.hwvip&&(m="hyy",r="huiyuan p"+b.userinfo.hwlevel),b.userinfo.head&&(g=b.userinfo.head.replace(/140/,"40")||"http://t0.qlogo.cn/mbloghead/01676c4b10bbdb6f2618/50"),d+='<li class="np-post '+e+'" id="msg_'+b.id+'" tid="'+b.targetinfo.targetid+'"><div class="np-post-body"><div class="np-post-header"><img class="np-avatar '+k+'"  post_uid="'+b.userinfo.userid+'" src="'+g+'" alt="\u5934\u50cf"><span class="'+m+'"><a href="javascript:void(0)" class="np-user '+
k+'" post_uid="'+b.userinfo.userid+'">'+b.userinfo.nick+'</a><a href="http://film.qq.com/vip.html?ptag='+n+'" target = "_blank" class="'+r+'"></a></span>\u56de\u590d\u4e86\u4f60\u7684\u8bc4\u8bba<span class="np-text-strong">'+this.subString(b.parentinfo.content,46)+'</span><span class="np-time" date="'+b.tipstime+'">'+this.formatTime(b.tipstime)+'</span><a class="np-btn np-btn-report report" id="report_msg_'+b.id+'">\u4e3e\u62a5</a></div><div class="np-post-content">'+v+'<a class="np-link-weak" target="_blank" href="'+
(void 0!=b.targetinfo?b.targetinfo.url:"")+'">'+b.targetinfo.title+'</a></div><div class="np-post-footer"><a href="javascript:void(0)" class="np-btn np-btn-upvote upvote" id="am_'+b.id+'">(<em>'+b.up+'</em>)</a><a href="javascript:void(0)" class="np-btn np-btn-reply reply">\u56de\u590d</a></div></div><ul class="children"></ul></li>');"6"==b.tipstype&&(d+='<li class="np-post '+e+'" id="msg_'+b.id+'" tid="'+b.targetinfo.targetid+'">',d+='<div class="np-post-body"><div class="np-post-header">',d+='<img class="np-avatar '+
k+'"  post_uid="'+b.userinfo.userid+'" src="http://t0.qlogo.cn/mbloghead/01676c4b10bbdb6f2618/50" alt="\u5934\u50cf">',d+='\u6587\u7ae0<a href="javascript:void(0)" style="cursor:default">'+b.targetinfo.title+'</a>\u5f15\u7528\u4e86\u4f60\u7684\u8bc4\u8bba<span class="np-text-strong">'+this.subString(b.content,46)+"</span>",d+='<span class="np-time" date="'+b.tipstime+'">'+this.formatTime(b.tipstime)+"</span>",d+="</div>",d+='<div class="np-post-content">',d+='<a class="np-link-weak" target="_blank" href="'+
(b.targetinfo?b.targetinfo.url:"")+'">'+b.targetinfo.title+"</a>",d+="</div>",d+='<div class="np-post-footer">',d+="</div></div>",d+='<ul class="children"></ul>',d+="</li>");var u,g=" ";b.targetinfo&&(u=b.targetinfo.url||"",g=b.targetinfo.title||"");"5"==b.tipstype&&(d+='<li class="post np-post '+e+'">',d+='<div class="np-post-header">',d+='<span class="np-avatar np-avatar-report"></span>',d+='\u4f60\u4e3e\u62a5\u4e86<a href="javascript:void(0)" post_uid='+b.userinfo.userid+'  class="np-user '+k+
'">'+(""!=b.userinfo.nick?b.userinfo.nick:"\u7f51\u53cb")+"</a>",d+='\u7684\u8bc4\u8bba\uff1a<span class="np-text-strong">'+this.subString(b.content,46)+"</span>",d+='<span class="np-time time" date="'+b.tipstime+'">'+this.formatTime(b.tipstime)+"</span>",d+="</div>",d+='<div class="np-post-content">',d+='<div class="message-content">',d+="<div>"+(2==b.checkstatus?"\u7ecf\u5ba1\u6838\u88ab\u5220\u9664":"\u7ecf\u5ba1\u6838\u4e3e\u62a5\u65e0\u6548")+"</div>",d+="</div>",d+='<a class="np-link-weak" target="_blank"  href="'+
u+'">'+g,d+='</a></div><div class="np-post-footer"></div></li>');"9"==b.tipstype&&(d+='<li class="post np-post '+e+'">',d+='<div class="np-post-header">',d+='<span class="np-avatar np-avatar-report"></span>',d+='\u4f60\u4e3e\u62a5\u7684\u7528\u6237<a href="javascript:void(0)" post_uid='+b.userinfo.userid+'  class="np-user '+k+'">'+(""!=b.userinfo.nick?b.userinfo.nick:"\u7f51\u53cb")+"</a>",d+='<span class="np-time time" date="'+b.tipstime+'">'+this.formatTime(b.tipstime)+"</span>",d+="</div>",d+=
'<div class="np-post-content">',d+='<div class="message-content">',d+="<div>"+(1==b.reportinfo.checkstatus?"\u7ecf\u5ba1\u6838\u4e3e\u62a5\u65e0\u6548":"\u5df2\u7ecf\u88ab\u7981\u8a00")+"</div>",d+="</div>",d+='<a class="np-link-weak" target="_blank"  href="'+u+'">'+g,d+='</a></div><div class="np-post-footer"></div></li>');b.userinfo.head&&b.userinfo.head.replace(/140/,"40")}"myComment"==c&&(h="post_",c="",c=0!=b.parent&&b.parentinfo?"<div>\u56de\u590d\u4e86<a post_uid="+b.parentinfo.userinfo.userid+
' href="javascript:void(0)" class="np-user '+k+'">'+b.parentinfo.userinfo.nick+'</a>\u7684\u8bc4\u8bba<span class="np-text-strong">'+this.subString(b.parentinfo.content,46)+"</span></div>":"\u53d1\u8868\u8bc4\u8bba",e='<a href="'+b.targetinfo.url+'" target = "_blank" class="np-link-weak">'+(b.targetinfo.title?b.targetinfo.title:" ")+"</a>",d='<li class="np-post" id='+h+""+b.id+" tid="+b.targetinfo.targetid+'><div class="np-post-body"><div class="np-post-header"><span class="np-time">'+(b.time?this.formatTime(b.time):
"\u521a\u521a")+"</span>"+c+'</div><div class="np-post-content">'+v+e+'</div><div class="np-post-footer"><span class="np-btn-upvote">'+b.up+'</span><span class="np-btn-reply reply">'+b.repnum+'</span><span class="np-btn-delete delete" id=delete_'+b.id+'>\u5220\u9664</span></div></div><ul class="children"></ul></li>');return d},loadMyMessage:function(){var b=this,c=this.options,e=c.$urlapi,f="",d=c.centerPageSize,g=1;1==c.$urlapi.pageflag&&(d=20,g=2);a.ajax({url:c.fetchUrl+"user/"+c.$urlapi.userId+
"/msg?msgid="+c.$urlapi.msgid+"&pageflag="+c.$urlapi.pageflag+"&reqnum="+d,dataType:"jsonp",beforeSend:function(){b._tips0=(new Date).getTime()},success:function(l){var h=(new Date).getTime();if(8==l.errCode)b.showLoginLayer();else{if(0==l.errCode){if(0==e.pageflag&&(e.msgid=e.first=l.data.first,e.last=l.data.last,a("#my-message-list").html(""),l.data.retnum<l.data.total&&10==l.data.retnum&&a("#loadMsgMore").show(),0==l.data.retnum)){a("#my-message").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u63d0\u9192").show();
a("#loadMsgMore").hide();return}1==e.pageflag&&(e.msgid=e.last=l.data.last);var k="";2==e.pageflag&&(e.msgid=e.first=l.data.first,k="blueflag");a.each(l.data.message,function(a,c){f+=b.myCreateHtml(c,"message",k)});1==c.$urlapi.pageflag?(a("#my-message-list").append(f),b.iframeHeight()):(a("#my-message-list").prepend(f),b.iframeHeight(),a("#my-message-list .blueflag").each(function(c,d){b.blueLine("#"+a(this).attr("id"))}));2==g&&b.conHeight(2);b.iframeHeight();l.data.retnum<d||l.data.total<=d?(a("#loadMsgMore>span").hide(),
a("#loadMsgMore>em").removeClass("np-load-more-loading")):(a("#loadMsgMore>span").show(),a("#loadMsgMore>em").hide());a("#my-message").children(".tipInfo").hide();b.iframeHeight()}else 0==l.errCode&&0==l.data.retnum?0==a("#my-message-list li").length?a("#my-message").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u63d0\u9192").show():a("#my-message").children(".tipInfo").hide():(a("#my-message").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u63d0\u9192").show(),
a("#loadMsgMore").hide());Qoss("wdtx",b._tips0,{1:b._tips0+1,2:h,3:h},100)}}})},loadMyComment:function(){var b=this,c=this.options,e=c.centerPageSize;0==c.$urlapi_mycomment.pageflag&&(c.$urlapi_mycomment.last=0);1==c.$urlapi_mycomment.pageflag&&(e=20);a.ajax({url:c.fetchUrl+"user/"+c.$urlapi_mycomment.userId+"/comment?lastid="+c.$urlapi_mycomment.last+"&pageflag="+c.$urlapi_mycomment.pageflag+"&reqnum="+e,dataType:"jsonp",jsonpCallback:"myComment",beforeSend:function(){b._myCom0=(new Date).getTime()},
success:function(f){var d="";if(8==f.errCode)b.showLoginLayer();else{if(0==f.errCode){var g=(new Date).getTime(),h=f.data.usermeta.region.replace(/:/g," "),h=""!=a.trim(h)?h:"\u817e\u8baf\u7f51\u53cb";1==c.huiyuan&&1==f.data.usermeta.hwvip&&(a("#myuserInfo").find("span:first").addClass("hyw"),a("#myuserInfo .hyw a").addClass("huiyuan p"+f.data.usermeta.hwlevel),1==c.film&&a("#myuserInfo .hyw a").attr("href","http://film.qq.com/vip.html?ptag=film_direct.comment"));a("#myuserInfo").find("img").attr("src",
f.data.usermeta.head||"");a("#myuserInfo").find(".np-user").html(f.data.usermeta.nick);a("#myuserInfo").find(".a").html(h);a("#myuserInfo").find(".b").html(f.data.usermeta.upnum);a("#myuserInfo").find(".c").html(f.data.usermeta.commentnum);a("#myuserInfo").show();if(0==c.$urlapi_mycomment.pageflag&&(c.$urlapi_mycomment.msgid=c.$urlapi_mycomment.first=f.data.first,c.$urlapi_mycomment.last=f.data.last,a("#my-notification-list").html(""),10==f.data.retnum&&a("#loadCmtMore").show(),0==f.data.retnum)){a("#my-notification").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show();
a("#loadCmtMore").hide();a("#myuserInfo").hide();b.iframeHeight();return}1==c.$urlapi_mycomment.pageflag&&(c.$urlapi_mycomment.last=f.data.last);a.each(f.data.comments,function(a,c){d+=b.myCreateHtml(c,"myComment")});a("#my-notification-list").append(d);b.conHeight(2);b.iframeHeight();setTimeout(function(){b.iframeHeight()},200);f.data.retnum<e||f.data.total<=e?(a("#loadCmtMore>span").hide(),a("#loadCmtMore>em").removeClass("np-load-more-loading")):(a("#loadCmtMore>span").show(),a("#loadCmtMore>em").hide());
a("#my-notification").children(".tipInfo").hide()}else a("#my-notification").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show(),a("#loadCmtMore").hide(),0==a("#my-notification-list li").length&&a("#my-notification").children(".tipInfo").show(),b.iframeHeight();Qoss("wdpl",b._myCom0,{1:b._myCom0+1,2:g,3:g},100)}}})},clickLoadMore:function(){var b=this,c=this.options;a("#loadMsgMore>span").click(function(){a("#loadMsgMore>span").hide();a("#loadMsgMore>em").addClass("np-load-more-loading").show();
c.$urlapi.pageflag=1;c.$urlapi.msgid=c.$urlapi.last;b.loadMyMessage();sendClientStat(m,1,g,"clk_notice_more")});a("#loadCmtMore>span").click(function(){a("#loadCmtMore>span").hide();a("#loadCmtMore>em").addClass("np-load-more-loading").show();c.$urlapi_mycomment.pageflag=1;c.$urlapi_mycomment.msgid=c.$urlapi_mycomment.last;b.loadMyComment();sendClientStat(m,1,g,"clk_mycomment_more")})},creatPostLink:function(a){return"<a class='"+this.options.popupLink+" np-btn' targetid='"+a.targetid+"' commentid='"+
a.id+"' parentid='"+a.parent+"' href='javascript:void(0)'><img src='http://mat1.gtimg.com/www/niuping2013/postframe/transparent.gif' />\u67e5\u770b\u56de\u590d("+(a.rep?a.rep:a.repnum)+")</a>"},initPostFrame:function(){var b=this,c=this.options;a("#content").delegate("."+c.popupLink,"click",function(c){c=b.options.$loginFlag.data("nick");var f=b.options.$loginFlag.data("userPic"),d=a(this),g=d.attr("targetid"),h=d.attr("commentid"),d=d.attr("parentid");a(top.document.body).append('<iframe src="http://www.qq.com/coral/coralBeta3/postframeImg3.1.htm?'+
(new Date).getDate()+'" id="np-pop-iframe" allowtransparency="true" frameborder="0" scrolling="no" style="width: 100%; z-index: 9999; position: fixed; _position:absolute;*+position:fixed;top: 0px; left: 0px; border: none; overflow: hidden; height: 100%;" data-nick="'+c+'" data-pic="'+f+'" data-id="'+g+"_"+h+'" parentid="'+d+'"></iframe>')})},upLoadchange:function(b){var c=this;if(getUin()){var e,f;b.closest(".children").length?(b.closest(".children").find("#insertPicList_reply").show(),e=b.closest(".children").find("#insertPicList_reply"),
f=b.closest(".np-post").attr("id"),setTimeout(function(){c.iframeHeight()},600)):(a("#insertPicList").show(),e=a("#insertPicList"),f="np-reply-box");if(!(4<=e.find("img").length)){if(""!=b.val()){if(!/\.(gif|jpg|jpeg|png)$/i.test(b.val()))return e.find(".insert_piclist").append('<li style="padding-top:20px;color:red" class="upImgInfo">\u56fe\u7247\u7c7b\u578b\u5fc5\u987b\u662f.gif/.jpg/.png</li>'),setTimeout(function(){e.find(".upImgInfo").fadeOut().remove()},3E3),b.val(""),!1;b.parent().find("input[name=g_tk]").val(generateToken(getKey()));
b.parent().find("input[name=thrdes]").val(f);b.parent().submit();b.val("");e.find(".add_pic").unbind().html("").addClass("icon_loading_pic");clearTimeout(upLoadImgError);upLoadImgError=setTimeout(function(){"+"!=e.find(".add_pic").text()&&(e.find(".insert_piclist").append('<li style="padding-top:20px;color:#f30"  class="upImgInfo">\u51fa\u9519\u4e86\uff01\u56fe\u7247\u5fc5\u987b\u662f\u5c0f\u4e8e5M\u7684.gif/.jpg/.png</li>'),setTimeout(function(){e.find(".upImgInfo").fadeOut().remove()},3E3));e.find(".add_pic").removeClass("icon_loading_pic");
e.find(".add_pic").html('<i class="add">+</i>')},2E4)}c.iframeHeight()}}else c.showLoginLayer()},upLoadImg:function(){var b=this;k.delegate(".upimgbox","mouseenter",function(){jQuery(this).find(".iconbtn").fadeIn()});k.delegate(".upimgbox","mouseleave",function(){jQuery(this).find(".iconbtn").fadeOut()});k.delegate(".imgRemove","click",function(){4>=jQuery(this).closest(".insert_piclist").find("img").length&&jQuery(this).closest(".insert_piclist").find(".upAddPic").show();jQuery(this).closest(".children").length?
jQuery(this).closest(".children").find(".sybol_pic").show():jQuery(this).closest("#commentArea").length&&jQuery(this).closest("#commentArea").find(".sybol_pic").show();jQuery(this).closest("li").remove()});k.delegate(".imgLeft","click",function(){var a=jQuery(this).parent(),b=a.prev("li");0!=b.length&&a.insertBefore(b)});k.delegate(".imgRight","click",function(){var a=jQuery(this).parent(),b=a.next("li:not(.upAddPic)");0!=b.length&&a.insertAfter(b)});a("body").delegate(".add_file","click",function(){if(!getUin())return b.showLoginLayer(),
!1;var c;c=a(this).closest(".children").length?"insertPicList_reply":"insertPicList";if(b.isUpImg(c))return!1});a(".add_file").on("change",function(){b.upLoadchange(a(this))})}};coralComment._create()})(jQuery)});String.prototype.realLength=function(){return this.replace(/[^\x00-\xff]/g,"**").length};function topCallback(a){coralComment.pubCallback("top",a,(new Date).getTime());jQuery("#commentArea .sybol_pic").show();jQuery("#commentArea .upAddPic").show()}
function popCallback(a){coralComment.pubCallback("pop",a,(new Date).getTime())}function reportCallback(a){coralComment.pubCallback("report",a,(new Date).getTime())}function deleteCallback(a){coralComment.pubCallback("delete",a,(new Date).getTime())}function getUin(){var a="";if(jQuery.cookie("uin")){if(a=jQuery.cookie("uin"),a.match(/[1-9][0-9]*/)instanceof Array)return a.match(/[1-9][0-9]*/)[0]}else return a=jQuery.cookie("luin")}
function getKey(){return jQuery.cookie("skey")||jQuery.cookie("lskey")}function generateToken(a){var h=2013;if(a)for(var k=0,r=a.length;k<r;k++)h+=(h<<5)+a.charCodeAt(k);return h&2147483647}function publicLoginEvent(){parent.registerCoralEvent&&parent.registerCoralEvent.loginEvent?parent.registerCoralEvent.loginEvent():0!=jQuery(parent.document.getElementById("oneKey")).length?jQuery(parent.document.getElementById("oneKey")).click():jQuery(parent.document.getElementById("onekey")).click()}
function publicLogined(a,h,k){a&&(coralComment.onLogined(a,h,k),top.document.getElementById("np-pop-iframe")&&top.document.getElementById("np-pop-iframe").contentWindow.publicLogined(a,h,k))}function publicLogout(){coralComment.loginOut()}function Qoss(a,h,k,r){for(var g in k)k[g]-=h;jQuery('<img src="http://qos.report.qq.com/collect?type=1&name=coral_qq_com_'+a+"&"+jQuery.param(k)+'">').error(function(){jQuery(this).remove()}).load(function(){jQuery(this).remove()}).appendTo("body")}
function errorImg(a){a.src="http://mat1.gtimg.com/www/coral2.0/images/g.gif";a.onerror=null}
function sendClientStat(a,h,k,r,g){var m=location.protocol+"//"+location.host+location.pathname,b=parseInt(1E9*Math.random()),c=getUin()||"",e=jQuery.cookie("uid"),f=encodeURIComponent(location.host);if("coral"==a)if(1==h){h=1836;var d="coral.web.comment_detail.action"}else h=1837,d="coral.web.comment_detail.pgv";else 1==h?(h=1836,d="coral.web.article_detail.action"):(h=1837,d="coral.web.article_detail.pgv");g=g||0;g_btrace_BOSS=new Image(1,1);g_btrace_BOSS.src="http://btrace.qq.com/collect?sIp=0&iQQ="+
c+"&sBiz="+d+"&sOp="+r+"&iSta="+g+"&iTy="+h+"&iFlow="+b+"&isite="+a+"&iTargetid="+k+"&iuid="+e+"&iUrl="+m+"&idomain="+f}
function upLoadImg(a){clearTimeout(upLoadImgError);var h=jQuery("#"+a.data.thrdes);if(0==a.errCode){h.find(".insert_piclist").data("dataImg",a.data.picture);var k='<li class="list_item upimgbox"><img width=44 height=44 data=\'{"url":"'+a.data.picture[0].url+'","width":'+a.data.picture[0].width+',"height":'+a.data.picture[0].height+"}' src=\""+a.data.picture[0].url+'/100" alt="\u56fe\u7247"><b class="iconbtn imgRemove" style="">x</b><b class="iconbtn imgLeft"  style="">\u2190</b><b class="iconbtn imgRight" style="">\u2192</b></li>';h.find(".upAddPic").before(k)}else 26==
a.errCode?h.find(".insert_piclist").append('<li style="padding-top:20px; color:red" class="upImgInfo">\u56fe\u7247\u4e0d\u80fd\u5927\u4e8e5M\uff01</li>'):h.find(".insert_piclist").append('<li style="padding-top:20px; color:red" class="upImgInfo">\u4e0a\u4f20\u51fa\u9519\uff01</li>'),setTimeout(function(){h.find(".upImgInfo").fadeOut().remove()},3E3);a.data.thrdes&&(jQuery("#"+a.data.thrdes+" .add_pic").html("+").removeClass("icon_loading_pic"),4<=jQuery("#"+a.data.thrdes+" .insert_piclist img").length&&
(jQuery("#"+a.data.thrdes+" .upAddPic").hide(),jQuery("#"+a.data.thrdes+" .sybol_pic").hide()))};/*  |xGv00|0070e68192e6fa4a738b493305e3cf21 */